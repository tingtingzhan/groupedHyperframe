---
title: "Grouped Hyper Data Frame"
author: Tingting Zhan
date: today
format: 
  html:
    page-layout: full
    html-math-method: katex
    link-external-icon: true
    link-external-newwindow: true
number-sections: true
toc: true
toc-location: left
toc-depth: 4
toc-title: ''
editor: source
bibliography: groupedHyperframe.bib
knitr:
  opts_chunk: 
    collapse: true
    comment: "#" 
vignette: >
  %\VignetteIndexEntry{intro}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
---

```{=html}
<!--
`r knitr::asis_output('\U1f5dd')`
seems not needed
-->
```

The full vignette of R package **`groupedHyperframe`** ([CRAN](https://cran.r-project.org/package=groupedHyperframe), [Github](https://github.com/tingtingzhan/groupedHyperframe)) is too large to be hosted on CRAN.  The full vignette is located on [RPubs](https://rpubs.com) 

> <https://rpubs.com/tingtingzhan/groupedHyperframe>


The full vignette documents

-   the creation of *grouped hyper data frame*;
-   the creation of a grouped hyper data frame with one-and-only-one point-pattern hypercolumn;
-   the batch process on eligible marks for the one-and-only-one point-pattern hypercolumn in a (grouped) hyper data frame;
-   the computation of various summary statistics from one or more function-value-table hypercolumn(s) of a (grouped) hyper data frame;
-   the aggregation of summary statistics, over a (nested) grouping structure, in a grouped hyper data frame.

# Prerequisite

## Environment

Package **`groupedHyperframe`** requires R version 4.5.0 (released 2025-04-11) or higher ([macOS](https://cran.r-project.org/bin/macosx/), [Windows](https://cran.r-project.org/bin/windows/base/), [Linux](https://cran.r-project.org/bin/linux/)).

An Integrated Development Environment (IDE), e.g., [RStudio](https://posit.co/download/rstudio-desktop/) [@RStudio] or [Positron](https://positron.posit.co/download.html), is not required, but highly recommended.

This vignette is created under `r R.version$version.string` using packages **`knitr`** [@knitr, v`r packageVersion('knitr')`; @knitr15; @knitr14], **`quarto`** [@quarto, v`r packageVersion('quarto')` with [Quarto](https://quarto.org/docs/get-started/) v`r quarto::quarto_version()`] and **`rmarkdown`** [@rmarkdown, v`r packageVersion('rmarkdown')`; @rmarkdown18; @rmarkdown20]. Package documentation is facilitated using package **`roxygen2`** [@roxygen2, v`r packageVersion('roxygen2')`]

```{r}
#| code-fold: true
#| code-summary: "Environment on author's computer"
#| label: author-env
Sys.info()[c('sysname', 'release', 'machine')]
R.version
```

## Enhancement {#sec-enhance}

Package **`groupedHyperframe`** `Enhances` the **`spatstat.*`** family of packages [@spatstat15; @spatstat05].

Package **`groupedHyperframe`** `Enhances` package **`spatstat.explore`** (dev v`r packageVersion('spatstat.explore')`), with

-   additional `S3` method dispatches to `fv.object`;
-   batch processes on eligible `marks` of `ppp.object`, `ppplist` and `hyperframe`.

Package **`groupedHyperframe`** `Enhances` package **`spatstat.geom`** (dev v`r packageVersion('spatstat.geom')`), with

-   a new `S3` class `'groupedHyperframe'` that `inherits` from the class `'hyperframe'`;
-   additional `S3` method dispatches to `ppp.object`;
-   additional `S3` method dispatches to the class `'tess'`;
-   additional `S3` method dispatches to the class `'anylist'`;
-   additional `S3` method dispatches to the class `'solist'`;
-   additional `S3` method dispatches to the class `'ppplist'`;
-   additional `S3` method dispatches to the class `'hyperframe'`;
-   a new `S3` class `'vectorlist'` that `inherits` from the class `'anylist'`;
-   a new `S3` class `'fvlist'` that `inherits` from the class `'anylist'`.



## Dependency

Package **`groupedHyperframe`** `Imports` packages

-   **`cli`** [@cli, v`r packageVersion('cli')`], for attractive command line interfaces
-   `r '\U1f5dd'` **`GET`** [@GET, v`r packageVersion('GET')`], key dependency, for global envelope test
-   **`ggplot2`** [@ggplot2, v`r packageVersion('ggplot2')`], **`geomtextpath`** [@geomtextpath, v`r packageVersion('geomtextpath')`], **`scales`** [@scales, v`r packageVersion('scales')`] for educational visualization
-   `r '\U1f5dd'` **`matrixStats`** [@matrixStats, v`r packageVersion('matrixStats')`], key dependency, for matrix arithmetic
-   **`parallel`** shipped with vanilla `r R.version$version.string`, for parallel computing
-   `r '\U1f5dd'` **`pracma`** [@pracma, v`r packageVersion('pracma')`], key dependency, for (cumulative) trapezoidal integration
-   `r '\U1f5dd'` **`SpatialPack`** [@SpatialPack, v`r packageVersion('SpatialPack')`], key dependency, for TjÃ¸stheim's coefficient of spatial association
-   `r '\U1f5dd'` **`spatstat.explore`** (dev v`r packageVersion('spatstat.explore')`), **`spatstat.geom`** (dev v`r packageVersion('spatstat.geom')`), **`spatstat.random`** (dev v`r packageVersion('spatstat.random')`), key dependency, for spatial statistics

Package **`groupedHyperframe`** `Suggests` packages

-   **`rpart`** [@rpart v`r packageVersion('rpart')`], required by function `spatstat.explore::rocEngine()` as of dev v`r packageVersion('spatstat.explore')`.
-   `r '\U1f5dd'` **`spatstat.data`** (dev v`r packageVersion('spatstat.data')`), key suggest, for example spatial data set
-   `r '\U1f5dd'` **`survival`** [@survival, v`r packageVersion('survival')`], key suggest.

## **`spatstat.*`** Family

Package **`groupedHyperframe`** requires the development versions of the **`spatstat.*`** family of packages.

```{r}
#| eval: false
pak::pak('spatstat/spatstat')
pak::pak('spatstat/spatstat.data')
pak::pak('spatstat/spatstat.explore')
pak::pak('spatstat/spatstat.geom')
pak::pak('spatstat/spatstat.linnet')
pak::pak('spatstat/spatstat.model')
pak::pak('spatstat/spatstat.random')
pak::pak('spatstat/spatstat.sparse')
pak::pak('spatstat/spatstat.univar')
pak::pak('spatstat/spatstat.utils')
```


## Package **`groupedHyperframe`**

Experimental (and maybe unstable) features of package **`groupedHyperframe`** are released *extremely frequently* to [Github](https://github.com/tingtingzhan/groupedHyperframe). [Active developers should use the Github version; suggestions and bug reports are welcome!]{style="background-color: #FFFF00"} Stable releases to [CRAN](https://CRAN.R-project.org/package=groupedHyperframe) are typically updated every 2 to 3 months, or when the authors have an upcoming manuscript in the peer-reviewing process.

```{r}
#| eval: false
pak::pak('tingtingzhan/groupedHyperframe')
```

```{r}
#| eval: false
#| code-fold: true
#| code-summary: "Developers, do NOT use the CRAN version!"
utils::install.packages('groupedHyperframe') # Developers, do NOT use!!
```

# Getting Started {#sec-start}

Examples in the full vignette require that the `search` path has

```{r}
#| message: false
#| label: search
library(groupedHyperframe)
library(survival)
```

# Peer-Reviewed Publications

Package **`groupedHyperframe`** plays a pivotal role in these peer reviewed publications from the authors.

## @Zhan25

> `r citation(package = 'hyper.gam')[[1L]] |> format(style = 'text') |> gsub(pattern = '\n', replacement = ' ', x = _)`

<details>

<summary>[BibTeX](https://ctan.org/pkg/bibtex) and/or [BibLaTeX](https://ctan.org/pkg/biblatex) entries for [LaTeX](https://www.latex-project.org) users</summary>

```{r}
#| echo: false
#| comment: ''
c(
  citation(package = 'hyper.gam'),
  citation(package = 'groupedHyperframe')
) |> toBibtex()
```

</details>

as well as @Yi25; @Yi23a; @Yi23b, was featured with a hyper data frame *`Ki67q`* with a numeric-hypercolumn *`logKi67.quantile`*. Functions in the R code-chunk below are explained in the full vignette.

```{r}
#| code-fold: true
#| code-summary: 'R code in @Zhan25'
Ki67q = groupedHyperframe::Ki67 |>
  within.data.frame(expr = {
    x = y = NULL # remove x- and y-coords for non-spacial application
  }) |>
  as.groupedHyperframe(group = ~ patientID/tissueID) |> 
  quantile(probs = seq.int(from = .01, to = .99, by = .01)) |> 
  aggregate(by = ~ patientID)
```

```{r}
#| message: false
#| code-fold: true
#| code-summary: 'A `hyperframe` object *`Ki67q`*: aggregated quantiles'
Ki67q |>
  head()
```

Readers are encouraged to learn more about this application from package **`hyper.gam`** ([CRAN](https://CRAN.R-project.org/package=hyper.gam), [Github](https://github.com/tingtingzhan/hyper.gam)) [vignette](https://rpubs.com/tingtingzhan/hyper_gam), section *Quantile Index*.

```{r}
#| code-fold: true
#| error: true
#| code-summary: 'Functions mentioned in @Zhan25 but later deprecated'
aggregate_quantile()
```


# Acknowledgement

This work is supported by National Institutes of Health, U.S. Department of Health and Human Services grants

-   R01CA222847 ([I. Chervoneva](https://orcid.org/0000-0002-9104-4505), [T. Zhan](https://orcid.org/0000-0001-9971-4844), and [H. Rui](https://orcid.org/0000-0002-8778-261X))
-   R01CA253977 (H. Rui and I. Chervoneva).




# References {.appendix}

::: {#refs}
:::
